# ML System Design Doc - [RU]
## Дизайн ML системы - MemeGen

### 1. Цели и предпосылки 
#### 1.1. Зачем идем в разработку продукта?  

- Создать телеграм канал с автогенерирующимися мемами, с дальнейшей монетизацией путем продажи рекламы.
- Сейчас на создание мема уходит больше времени чем на его генерацию с использованием нейронных сетей.  

#### 1.2. Бизнес-требования и ограничения  

- Телеграм бот с возможностью генерирования мемов на различные тематики.     

#### 1.3. Что входит в скоуп проекта/итерации, что не входит   

- #TODO

#### 1.4. Предпосылки решения  

### 2. Методология `Data Scientist`     

#### 2.1. Постановка задачи  

- Дообучаем генеративную модель на исторических данных из различных пабликов с мемами.

#### 2.2. Блок-схема решения  

- #TODO

#### 2.3. Этапы решения задачи `Data Scientist`

- Этап 1 - Анализ данных
- Этап 2 - Анализ моделей, существующих решений
- Этап 3 - Обучение модели
- Этап 4 - Создание сервиса (бота)
  
### 3. Подготовка пилота  
  
#### 3.1. Способ оценки пилота

Для оценивания пилота нужно будет провести A/B тестирование для сравнения метрик, которые были на обычных мемах, и мемах, которые сгенерированы с использованием нашего бота.

Метрики основанные на постах в телеграм каналах:
- Реакции пользователей на посты с мемами, двух типов:
    - Положительная - палец вверх (далее обозначамая как $l$),
    - Отрицательная - палец вниз (далее обозначамая как $d$).

- Среднее относительных реакций на публикациях в различных пабликах:
  $$AvgReact = \frac{1}{N}\sum_{i=1}^{N}\frac{l_i}{p_i}, $$
  где $l_p$ количество лайков на мемах в паблике $i$, $p_i$ количество запосченых мемов в паблике, $N$ - количество пабликов

- Взвешенное среднее относительных реакций на публикациях в различных пабликах:
  $$WeightedAvgReact = \frac{M}{P}\sum_{i=1}^{N}\frac{m_il_p}{n_p}, $$
  где $m_i$ количество человек в паблике $i$, а $M$ - общее количество людей в тестируемых пабликах

Также можно ввести метрики, которые проверяют качество мемах на запосченых в пабликах с использованием предложки этих пабликов. Это позволяет тестировать модель на еще большем количестве пабликов, а не только на тех, которыми мы владеем:

Метрики основанные на постах в телеграм каналах:
- Среднее относительных реакций на публикациях в различных пабликах:
  $$AvgSug = \frac{1}{N}\sum_{i=1}^{N}\frac{a_i}{p_i}, $$
  где $a_p$ количество мемов опубликованных через предложку $i$, $p_i$ количество предложений в предложку в паблике, $N$ - количество пабликов

- Взвешенное среднее относительных реакций на публикациях в различных пабликах:
  $$WeightedAvgSug = \frac{M}{P}\sum_{i=1}^{N}\frac{m_ia_p}{n_p}, $$
  где $m_i$ количество человек в паблике $i$, а $M$ - общее количество людей в тестируемых пабликах

  
#### 3.2. Что считаем успешным пилотом  

Количество просмотров, количество подписщиков, количество новых пользователей.<br>

Предполагается, что пилот успешный, если удовлетворяется хотя бы одно из следующих неравенств, вычисляемых основываясь на информации о сгенерированых мемах :

$$
AvgReact \geq 0.7 \\
WeightedAvgReact \geq 0.7 \\
AvgSug \geq 0.7 \\
WeightedAvgSug \geq 0.7\\
$$

Либо же если пройдены A/B тесты по предпочтению сгенерированных мемов сделанным самостоятельно.

#### 3.3. Подготовка пилота  
  
Вычислительные ресурсы: VPS с 4x3.3 vCPU, 8GB RAM, 80GB NVME SSD.

### 4. Внедрение для production систем
  
#### 4.1. Архитектура решения 
  
- #TODO
  
#### 4.2. Описание инфраструктуры и масштабируемости 
  
- #TODO
  
#### 4.3. Требования к работе системы  
  
Так как производство мемов это не история, которая требует быстрых и моментальных ответов. То задержка может быть достаточно большой, но предполагается, что не будет превышать 20-ти минут.
Поскольку доставка осуществляется при помощи серверов Telegram, то общую пропускную способность определять, наверное, не имеет смысла, при условии, что дана задержка
  
#### 4.4. Безопасность системы  
  
Одна из уязвимостей системы - ддос атака. А именно, перегрузить модель, которая будет обрабатывать данные в облаке.
Последующие оценки будут вычислены позже исходя из выбранной модели
  
#### 4.5. Безопасность данных   
  
На этапе сбора данных могут быть получены данные из 3-х источников, которые могут иметь авторские права. Поэтому есть маленькая вероятность нарушения законодательства в области цифрового авторского права.
  
#### 4.6. Издержки  
  
На данный момент предполагается, издержки будут на оплату сервера в размере 1000 руб./ месяц
  
#### 4.5. Integration points  
  
- #TODO
  
#### 4.6. Риски  
  
Существует вероятность, что не весь заявленный функционал возможно будет реализовать из-за ограниченного количества ресурсов.

Также существуют риски того, что не все метрики удасться замерить на крупных мемных пабликах.


